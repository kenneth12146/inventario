<!DOCTYPE html>
<html lang="es">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Seed negocio</title>
<style>
body{font-family:system-ui;background:#0f1216;color:#e6e6e6;margin:0;padding:24px}
.card{background:#12161c;border:1px solid #2a2f38;border-radius:12px;padding:16px;max-width:720px}
label{display:block;margin:8px 0 4px}
input{width:100%;padding:10px;border-radius:10px;border:1px solid #2a2f38;background:#0b0e11;color:#e6e6e6}
.btn{background:#1f6feb;border:1px solid #2b6fe1;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;margin-top:12px}
pre{white-space:pre-wrap;background:#0b0e11;border:1px solid #2a2f38;border-radius:8px;padding:12px;margin-top:12px}
</style>
</head>
<body>
<div class="card">
  <h1>Sembrar negocio demo</h1>
  <label>Nombre</label><input id="nombre" value="Tienda Local"/>
  <label>Correo</label><input id="correo" value="local@demo.com"/>
  <label>Contraseña</label><input id="pass" type="password" value="1234"/>
  <button class="btn" id="btnSeed">Crear negocio</button>
  <pre id="out">Esperando…</pre>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyByhD4vM7DCjjIOBoaUuLH_wRh93DcRdkw",
  authDomain: "inventario-b4431.firebaseapp.com",
  projectId: "inventario-b4431",
  storageBucket: "inventario-b4431.firebasestorage.app",
  messagingSenderId: "229641140897",
  appId: "1:229641140897:web:c1ac156045b0edbf110ee0",
  measurementId: "G-RG2Y7DXCEC"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function sha256(text){
  const enc = new TextEncoder();
  const buf = await crypto.subtle.digest('SHA-256', enc.encode(text));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

document.getElementById('btnSeed').onclick = async ()=>{
  const out = document.getElementById('out');
  const nombre = document.getElementById('nombre').value.trim();
  const correo = document.getElementById('correo').value.trim();
  const pass = document.getElementById('pass').value;
  try{
    const passHash = await sha256(pass);
    const ref = await addDoc(collection(db,'negocios'), {
      nombre, correo, passwordHash: passHash,
      usuarios: [
        { usuario:'admin',  passwordHash: passHash, rol:'administrador' },
        { usuario:'cajero', passwordHash:'',       rol:'cajero' }
      ],
      productos: [], ventas: [], auditoria: [],
      caja: { abierta:false, saldoInicial:0, movimientos:[] }
    });
    out.textContent = 'Negocio creado: ' + ref.id + '\\nLogin negocio -> ' + correo + ' / ' + pass;
  }catch(e){
    out.textContent = 'ERROR: ' + (e.message || e);
    console.error(e);
  }
};
</script>
</body>
</html>
